## 3.1.11. Phân tích yêu cầu phân hệ 8: Danh sách diễn viên (ActorsPage)

### 3.1.11.1. Mục tiêu và phạm vi phân hệ

Phân hệ ActorsPage là trang hiển thị danh sách các diễn viên trong hệ thống, đóng vai trò như một cổng thông tin giúp người dùng khám phá thông tin về các diễn viên điện ảnh. Trang này cho phép người dùng tra cứu diễn viên theo quốc tịch, sắp xếp theo nhiều tiêu chí và tương tác thông qua chức năng thích (like) diễn viên.

Phạm vi phân hệ bao gồm:
- Hiển thị danh sách diễn viên theo dạng card với avatar, tên, tiểu sử ngắn, lượt xem và lượt thích
- Bộ lọc theo quốc tịch (được tải động từ API)
- Sắp xếp danh sách theo: phổ biến nhất, mới nhất, được thích nhất
- Phân trang với số trang điều hướng
- Tương tác thích/bỏ thích diễn viên với cập nhật lạc quan (optimistic update)
- Điều hướng sang trang chi tiết diễn viên
- Sidebar hiển thị danh sách phim đang chiếu
- Bộ lọc mobile dạng Drawer cho thiết bị di động

### 3.1.11.2. Tác nhân và quyền hạn

| Tác nhân | Quyền hạn |
|:---------|:----------|
| Guest (khách) | Xem danh sách diễn viên, lọc theo quốc tịch, sắp xếp, phân trang, xem chi tiết diễn viên |
| User (thành viên) | Tất cả quyền của Guest + thích/bỏ thích diễn viên |

### 3.1.11.3. Yêu cầu chức năng (FR) – ActorsPage

| ID | Yêu cầu | Mô tả | Ưu tiên |
|:---|:--------|:------|:--------|
| FR-AC-01 | Hiển thị danh sách diễn viên | Render danh sách diễn viên dạng card: avatar, tên, tiểu sử ngắn, lượt xem, lượt thích | Cao |
| FR-AC-02 | Lọc theo quốc tịch | Dropdown chọn quốc tịch (danh sách được tải động từ API) | Cao |
| FR-AC-03 | Sắp xếp danh sách | Sắp xếp theo: phổ biến nhất (viewCount), mới nhất (createdAt), được thích nhất (likeCount) | Cao |
| FR-AC-04 | Phân trang | Hiển thị 10 diễn viên/trang với navigation số trang, cuộn lên đầu khi chuyển trang | Cao |
| FR-AC-05 | Thích diễn viên | User có thể thích hoặc bỏ thích diễn viên, cập nhật số lượt thích realtime | Cao |
| FR-AC-06 | Hiển thị lượt xem | Hiển thị số lượt xem của mỗi diễn viên | Trung bình |
| FR-AC-07 | Điều hướng chi tiết | Click vào diễn viên hoặc avatar để xem trang chi tiết (/dien-vien-chi-tiet/:slug) | Cao |
| FR-AC-08 | Sidebar phim đang chiếu | Hiển thị danh sách 5 phim đang chiếu ở sidebar với poster, tên, rating | Trung bình |
| FR-AC-09 | Bộ lọc mobile | Drawer bộ lọc cho thiết bị di động với nút mở/đóng | Cao |
| FR-AC-10 | Đặt lại bộ lọc | Nút reset để đưa tất cả bộ lọc về trạng thái mặc định | Trung bình |
| FR-AC-11 | URL State Sync | Bộ lọc và trang hiện tại được lưu trong URL params để chia sẻ và bookmark | Trung bình |
| FR-AC-12 | Loading State | Hiển thị loading spinner toàn màn hình khi tải dữ liệu | Cao |

### 3.1.11.4. Yêu cầu phi chức năng (NFR)

| ID | Yêu cầu | Mô tả |
|:---|:--------|:------|
| NFR-AC-01 | Hiệu năng | Trang load < 3 giây, API response < 500ms, gọi song song nhiều API bằng Promise.all |
| NFR-AC-02 | Responsive | Hỗ trợ desktop và mobile, layout thích ứng với breakpoint, Drawer filter trên mobile |
| NFR-AC-03 | URL State | Bộ lọc được lưu trong URL params (?quoc-tich=...&sap-xep=...&page=...) để chia sẻ và bookmark |
| NFR-AC-04 | UX Optimistic | Cập nhật UI ngay khi thích/bỏ thích (optimistic update), rollback nếu API lỗi |
| NFR-AC-05 | Tương thích | Hoạt động tốt trên Chrome, Firefox, Safari, Edge phiên bản mới nhất |
| NFR-AC-06 | Khả dụng | Có fallback khi API lỗi (hiển thị danh sách rỗng), không crash ứng dụng |

### 3.1.11.5. Quy tắc nghiệp vụ

- **BR-AC-01 (Chống spam click):** Khi đang gọi API like cho một diễn viên, nút like của diễn viên đó bị vô hiệu hóa (disabled) để tránh gọi trùng.

- **BR-AC-02 (Optimistic Update):** Khi thích/bỏ thích, UI cập nhật ngay lập tức trước khi API trả về. Số lượt thích được tính dựa trên trạng thái trước đó và không được xuống dưới 0.

- **BR-AC-03 (Rollback khi API lỗi):** Nếu API thích/bỏ thích trả lỗi, hệ thống rollback UI về trạng thái trước đó (cả số likeCount và trạng thái liked trong localStorage).

- **BR-AC-04 (Sync với server):** Sau khi API thành công, số likeCount được sync với giá trị từ server để đảm bảo nhất quán dữ liệu.

- **BR-AC-05 (Lưu trạng thái like vào localStorage):** Trạng thái đã thích/chưa thích được lưu vào localStorage với key `actor_liked_{actorId}` để persist qua các lần truy cập.

- **BR-AC-06 (Reset trang khi đổi bộ lọc):** Khi thay đổi quốc tịch hoặc cách sắp xếp, trang tự động reset về trang 1.

- **BR-AC-07 (Điều hướng đúng route):** Khi click vào diễn viên, hệ thống điều hướng đến `/dien-vien-chi-tiet/:slug` với slug của diễn viên.

- **BR-AC-08 (Quốc tịch động):** Danh sách quốc tịch được tải từ API `/api/v1/persons/nationalities` thay vì hardcode, đảm bảo dữ liệu luôn cập nhật theo database.

---

*Phần phân tích yêu cầu trên đây là cơ sở để thiết kế kiến trúc hệ thống, sơ đồ Use Case, Activity Diagram, Sequence Diagram và Class Diagram trong mục 3.2 tiếp theo.*
