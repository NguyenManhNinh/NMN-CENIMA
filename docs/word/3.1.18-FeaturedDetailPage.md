## 3.1.18. Phân tích yêu cầu phân hệ 15: Chi tiết Phim Hay (FeaturedDetailPage)

### 3.1.18.1. Mục tiêu và phạm vi phân hệ

Phân hệ FeaturedDetailPage là trang hiển thị nội dung chi tiết của một bài viết "Phim Hay Tháng", bao gồm tiêu đề, nội dung HTML đầy đủ, video trailer (nếu có), và các bộ phim được giới thiệu trong bài. Trang này cho phép người dùng đọc bài viết, xem trailer, tương tác thích và điều hướng đến các phim được đề cập.

Phạm vi phân hệ bao gồm:
- Hiển thị thông tin chi tiết bài viết (tiêu đề, nội dung HTML, thumbnail, ngày tạo)
- Hiển thị video trailer nhúng từ YouTube
- Hiển thị danh sách phim được giới thiệu trong bài (relatedMovies)
- Tương tác thích/bỏ thích bài viết
- Tăng lượt xem với cơ chế cooldown 24 giờ qua Redis
- Breadcrumb điều hướng
- Sidebar hiển thị phim đang chiếu

### 3.1.18.2. Tác nhân và quyền hạn

| Tác nhân | Quyền hạn |
|:---------|:----------|
| Guest (khách) | Xem nội dung bài viết, xem trailer, xem phim liên quan |
| User (thành viên) | Tất cả quyền của Guest + thích/bỏ thích bài viết |

### 3.1.18.3. Yêu cầu chức năng (FR) – FeaturedDetailPage

| ID | Yêu cầu | Mô tả | Ưu tiên |
|:---|:--------|:------|:--------|
| FR-FD-01 | Hiển thị nội dung bài viết | Hiển thị title, content (HTML), thumbnail, createdAt | Cao |
| FR-FD-02 | Nhúng video YouTube | Hiển thị trailer từ videoUrl, hỗ trợ nhiều định dạng URL YouTube | Cao |
| FR-FD-03 | Hiển thị phim liên quan | Render grid các bộ phim được giới thiệu trong bài (từ nội dung HTML) | Trung bình |
| FR-FD-04 | Thích bài viết | Toggle like với số lượt thích, yêu cầu đăng nhập | Cao |
| FR-FD-05 | Tăng lượt xem | Tự động tăng viewCount khi truy cập, cooldown 24h per viewer (userId hoặc IP) | Trung bình |
| FR-FD-06 | Breadcrumb | Hiển thị đường dẫn: Trang chủ > Phim Hay > [Tên bài viết] | Cao |
| FR-FD-07 | Sidebar phim đang chiếu | Hiển thị danh sách phim đang chiếu ở sidebar phải | Trung bình |
| FR-FD-08 | Loading State | Skeleton loading khi tải dữ liệu | Cao |
| FR-FD-09 | Xử lý 404 | Hiển thị trang lỗi nếu không tìm thấy bài viết | Cao |
| FR-FD-10 | Responsive content | Nội dung HTML responsive, ảnh trong bài tự co giãn | Trung bình |
| FR-FD-11 | Style nội dung | Áp dụng typography chuẩn cho content HTML (heading, paragraph, list) | Trung bình |

### 3.1.18.4. Yêu cầu phi chức năng (NFR)

| ID | Yêu cầu | Mô tả |
|:---|:--------|:------|
| NFR-FD-01 | Hiệu năng | Trang load < 3 giây, API response < 500ms |
| NFR-FD-02 | Bảo mật | JWT authentication cho like API |
| NFR-FD-03 | Responsive | Layout thích ứng desktop/tablet/mobile |
| NFR-FD-04 | SEO | Title và meta description động theo bài viết |
| NFR-FD-05 | Video Performance | Lazy load iframe YouTube để không ảnh hưởng initial load |

### 3.1.18.5. Quy tắc nghiệp vụ

- **BR-FD-01 (Chỉ hiển thị bài published):** Chỉ hiển thị bài viết có status = 'published'. Bài viết draft trả về 404.

- **BR-FD-02 (YouTube URL conversion):** Hỗ trợ nhiều định dạng URL YouTube: youtube.com/watch?v=, youtu.be/, youtube.com/embed/. Tự động convert sang embed URL.

- **BR-FD-03 (View cooldown 24h):** Sử dụng Redis key `featured_view:{articleId}:{viewerId}` với TTL 24h để tránh tăng view spam.

- **BR-FD-04 (Like yêu cầu đăng nhập):** API toggle like yêu cầu JWT token. Frontend redirect đến trang đăng nhập nếu chưa auth.

- **BR-FD-05 (Like state persistence):** Trạng thái like được lưu trong array likedBy và được kiểm tra khi load trang để hiển thị đúng trạng thái nút.

- **BR-FD-06 (Fallback khi Redis lỗi):** Nếu Redis không khả dụng, view count vẫn tăng nhưng không có cooldown (fallback to no cooldown).

- **BR-FD-07 (Content styling):** Nội dung HTML từ CMS được áp dụng các rule CSS: ảnh căn giữa với max-width 80%, heading không có border-bottom, paragraph có line-height phù hợp.

---

*Phần phân tích yêu cầu trên đây là cơ sở để thiết kế kiến trúc hệ thống, sơ đồ Use Case, Activity Diagram, Sequence Diagram và Class Diagram trong mục 3.2 tiếp theo.*
