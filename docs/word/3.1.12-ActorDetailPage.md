## 3.1.12. Phân tích yêu cầu phân hệ 9: Chi tiết diễn viên (ActorDetailPage)

### 3.1.12.1. Mục tiêu và phạm vi phân hệ

Phân hệ ActorDetailPage là trang hiển thị thông tin chi tiết của một diễn viên, bao gồm thông tin cá nhân, tiểu sử đầy đủ, thư viện hình ảnh và danh sách phim đã tham gia (filmography). Trang này cho phép người dùng khám phá sâu hơn về diễn viên yêu thích, xem gallery ảnh với chế độ slideshow tự động và tương tác thông qua chức năng thích (like).

Phạm vi phân hệ bao gồm:
- Hiển thị thông tin cá nhân diễn viên (tên, ảnh đại diện, ngày sinh, chiều cao, quốc tịch, nơi sinh, nghề nghiệp)
- Hiển thị tiểu sử ngắn (shortBio) và tiểu sử đầy đủ (biography/fullBio)
- Thư viện hình ảnh với chế độ xem phóng to (lightbox) và tự động chuyển ảnh (autoplay)
- Danh sách phim đã tham gia (filmography) với điều hướng đến chi tiết phim
- Tăng lượt xem (viewCount) với cơ chế cooldown 24 giờ
- Thích/bỏ thích diễn viên với optimistic update và rollback
- Sidebar hiển thị phim đang chiếu
- Breadcrumb điều hướng
- Fallback "Chưa cập nhật" khi thiếu dữ liệu

### 3.1.12.2. Tác nhân và quyền hạn

| Tác nhân | Quyền hạn |
|:---------|:----------|
| Guest (khách) | Xem thông tin diễn viên, xem gallery ảnh, xem filmography, xem tiểu sử, xem sidebar phim đang chiếu |
| User (thành viên) | Tất cả quyền của Guest + thích/bỏ thích diễn viên |

### 3.1.12.3. Yêu cầu chức năng (FR) – ActorDetailPage

| ID | Yêu cầu | Mô tả | Ưu tiên |
|:---|:--------|:------|:--------|
| FR-AD-01 | Hiển thị thông tin cá nhân | Hiển thị ảnh đại diện, tên, ngày sinh, chiều cao, quốc tịch, nơi sinh, nghề nghiệp | Cao |
| FR-AD-02 | Hiển thị tiểu sử ngắn | Hiển thị shortBio dạng italic, line clamp 4 dòng trên mobile | Cao |
| FR-AD-03 | Hiển thị tiểu sử đầy đủ | Section "TIỂU SỬ" với nội dung fullBio/biography đầy đủ | Cao |
| FR-AD-04 | Thư viện hình ảnh | Grid ảnh với preview, click mở Dialog xem phóng to | Cao |
| FR-AD-05 | Gallery Lightbox | Dialog xem ảnh full screen với nút prev/next, đóng bằng nút X | Cao |
| FR-AD-06 | Gallery Autoplay | Tự động chuyển ảnh mỗi 3 giây, có nút Play/Pause để điều khiển | Trung bình |
| FR-AD-07 | Hiển thị Filmography | Section "PHIM ĐÃ THAM GIA" với danh sách phim: poster, tên phim, vai diễn | Cao |
| FR-AD-08 | Điều hướng đến phim | Click vào phim trong filmography chuyển đến /phim/:slug | Cao |
| FR-AD-09 | Thích diễn viên | Nút like với số lượt thích, cập nhật realtime | Cao |
| FR-AD-10 | Hiển thị lượt xem | Badge hiển thị viewCount của diễn viên | Trung bình |
| FR-AD-11 | Tăng lượt xem | Tự động tăng viewCount khi truy cập, có cooldown 24h | Trung bình |
| FR-AD-12 | Breadcrumb | Hiển thị đường dẫn: Trang chủ > Diễn viên > [Tên diễn viên] | Cao |
| FR-AD-13 | Sidebar phim đang chiếu | Hiển thị 3 phim đang chiếu ở sidebar (desktop only) với poster, tên, rating | Trung bình |
| FR-AD-14 | Loading state | Hiển thị loading spinner toàn màn hình khi tải dữ liệu | Cao |
| FR-AD-15 | Xử lý 404 | Hiển thị thông báo "Không tìm thấy diễn viên" với nút quay lại danh sách | Cao |

### 3.1.12.4. Yêu cầu phi chức năng (NFR)

| ID | Yêu cầu | Mô tả |
|:---|:--------|:------|
| NFR-AD-01 | Hiệu năng | Trang load < 3 giây, API response < 500ms |
| NFR-AD-02 | Responsive | Layout thích ứng desktop/tablet/mobile, ảnh scroll ngang trên mobile |
| NFR-AD-03 | UX Optimistic | Cập nhật UI ngay khi thích/bỏ thích, rollback nếu API lỗi |
| NFR-AD-04 | Khả dụng | Có fallback "Chưa cập nhật" khi thiếu dữ liệu, không crash ứng dụng |
| NFR-AD-05 | Tương thích | Hoạt động tốt trên Chrome, Firefox, Safari, Edge phiên bản mới nhất |
| NFR-AD-06 | Accessibility | Gallery hỗ trợ điều hướng bằng nút, Breadcrumb có semantic rõ ràng |

### 3.1.12.5. Quy tắc nghiệp vụ

- **BR-AD-01 (Cooldown View 24h):** Lượt xem của một diễn viên chỉ được tăng một lần mỗi 24 giờ cho mỗi trình duyệt. Thời gian truy cập cuối được lưu trong localStorage với key `actor_view_{actorId}`. Nếu thời gian hiện tại trừ thời gian lưu nhỏ hơn 24 giờ (86,400,000ms), hệ thống không gọi API tăng view.

- **BR-AD-02 (Không tăng view liên tục):** Sử dụng useRef để đánh dấu đã tăng view trong session hiện tại (`viewIncrementedRef`), tránh gọi API trùng lặp khi component re-render.

- **BR-AD-03 (Optimistic Update Like):** Khi thích/bỏ thích, UI cập nhật ngay lập tức (isLiked, likeCount, localStorage) trước khi API trả về. Số likeCount không được xuống dưới 0.

- **BR-AD-04 (Rollback khi API lỗi):** Nếu API toggle like trả lỗi, hệ thống rollback về trạng thái trước đó bao gồm: isLiked state, likeCount trong actor state, và giá trị trong localStorage.

- **BR-AD-05 (Sync likeCount với server):** Sau khi API thành công, likeCount được sync với giá trị từ server (`res.data.likeCount`) để đảm bảo nhất quán.

- **BR-AD-06 (Fallback thiếu dữ liệu):** Khi các trường dữ liệu không có giá trị (biography, filmography, photos), hệ thống hiển thị text "Chưa cập nhật" thay vì để trống hoặc gây lỗi giao diện.

- **BR-AD-07 (Gallery an toàn):** Gallery chỉ hiển thị khi `actor.photos` tồn tại và có độ dài > 0. Autoplay chỉ hoạt động khi có nhiều hơn 1 ảnh.

- **BR-AD-08 (Loading diễn viên theo slug):** Hệ thống tải diễn viên theo slug từ URL params. Nếu không tìm thấy (actorData = null), hiển thị màn hình 404 với nút quay lại.

---

*Phần phân tích yêu cầu trên đây là cơ sở để thiết kế kiến trúc hệ thống, sơ đồ Use Case, Activity Diagram, Sequence Diagram và Class Diagram trong mục 3.2 tiếp theo.*
