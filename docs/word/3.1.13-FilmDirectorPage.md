# 3.1.13. Phân tích yêu cầu phân hệ 10: Danh sách đạo diễn (FilmDirectorPage)

## 3.1.13.1. Mục tiêu và phạm vi phân hệ

Phân hệ FilmDirectorPage là trang hiển thị danh sách các đạo diễn trong hệ thống, đóng vai trò như một cổng thông tin giúp người dùng tra cứu đạo diễn theo quốc tịch, sắp xếp theo nhiều tiêu chí và tương tác thông qua chức năng thích đạo diễn. Trang này là một phần quan trọng trong mục "Góc điện ảnh" của website, cung cấp trải nghiệm khám phá thông tin về các đạo diễn nổi tiếng trong ngành điện ảnh.

Phạm vi phân hệ bao gồm:
- Hiển thị danh sách đạo diễn theo dạng card với avatar, tên, tiểu sử ngắn, lượt xem và lượt thích.
- Bộ lọc quốc tịch động lấy từ API backend.
- Sắp xếp danh sách theo: phổ biến nhất, mới nhất, được thích nhất.
- Tương tác thích/bỏ thích đạo diễn với cập nhật lạc quan (optimistic update).
- Điều hướng sang trang chi tiết đạo diễn.
- Sidebar hiển thị danh sách phim đang chiếu.
- Bộ lọc mobile dạng Drawer cho thiết bị di động.
- Đồng bộ trạng thái bộ lọc với URL params để hỗ trợ chia sẻ và bookmark.

## 3.1.13.2. Tác nhân và quyền hạn

| Tác nhân | Quyền hạn |
|:---------|:----------|
| Guest (khách) | Xem danh sách đạo diễn, lọc theo quốc tịch, sắp xếp, phân trang, xem chi tiết đạo diễn, xem sidebar phim đang chiếu |
| User (thành viên) | Tất cả quyền của Guest + thích/bỏ thích đạo diễn |

## 3.1.13.3. Yêu cầu chức năng (FR)

| ID | Yêu cầu | Mô tả | Ưu tiên |
|:---|:--------|:------|:--------|
| FR-DR-01 | Hiển thị danh sách đạo diễn | Render danh sách đạo diễn dạng card: avatar, tên, tiểu sử ngắn, lượt xem, lượt thích | Cao |
| FR-DR-02 | Lọc theo quốc tịch | Dropdown chọn quốc tịch, dữ liệu lấy từ API `/api/v1/persons/nationalities?role=director` | Cao |
| FR-DR-03 | Sắp xếp danh sách | Sắp xếp theo 3 tiêu chí: phổ biến nhất (viewCount), mới nhất (createdAt), được thích nhất (likeCount) | Cao |
| FR-DR-04 | Phân trang | Hiển thị 10 đạo diễn/trang với navigation số trang, cuộn lên đầu khi chuyển trang | Cao |
| FR-DR-05 | Thích đạo diễn | User có thể thích hoặc bỏ thích đạo diễn, cập nhật số lượt thích realtime | Cao |
| FR-DR-06 | Hiển thị lượt xem | Hiển thị số lượt xem của mỗi đạo diễn dạng badge | Trung bình |
| FR-DR-07 | Điều hướng chi tiết | Click vào đạo diễn hoặc avatar để xem trang chi tiết đạo diễn (`/dao-dien-chi-tiet/:slug`) | Cao |
| FR-DR-08 | Sidebar phim đang chiếu | Hiển thị danh sách phim đang chiếu ở sidebar với poster, tên, rating | Trung bình |
| FR-DR-09 | Bộ lọc mobile | Drawer bộ lọc cho thiết bị di động với nút mở/đóng | Cao |
| FR-DR-10 | Đặt lại bộ lọc | Nút reset đưa tất cả bộ lọc về trạng thái mặc định (quốc tịch: Tất cả, sắp xếp: Phổ biến nhất) | Trung bình |
| FR-DR-11 | URL State Sync | Bộ lọc và trang hiện tại được lưu trong URL params (`?quoc-tich=&sap-xep=&page=`) để chia sẻ và bookmark | Trung bình |
| FR-DR-12 | Loading State | Hiển thị loading spinner toàn màn hình khi tải dữ liệu | Cao |

## 3.1.13.4. Yêu cầu phi chức năng (NFR)

| ID | Yêu cầu | Mô tả |
|:---|:--------|:------|
| NFR-DR-01 | Hiệu năng | Trang load < 3 giây, API response < 500ms, gọi song song nhiều API bằng Promise.all |
| NFR-DR-02 | Responsive | Hỗ trợ desktop và mobile, layout thích ứng với breakpoint, Drawer filter trên mobile |
| NFR-DR-03 | URL State | Bộ lọc được lưu trong URL params (`?quoc-tich=...&sap-xep=...&page=...`) để chia sẻ và bookmark |
| NFR-DR-04 | UX Optimistic | Cập nhật UI ngay khi thích/bỏ thích, rollback nếu API lỗi |
| NFR-DR-05 | Tương thích | Hoạt động tốt trên Chrome, Firefox, Safari, Edge phiên bản mới nhất |
| NFR-DR-06 | Khả dụng | Có fallback khi API lỗi (hiển thị danh sách rỗng), không crash ứng dụng |

## 3.1.13.5. Quy tắc nghiệp vụ

- **BR-DR-01**: Khi đang gọi API like cho một đạo diễn, nút like của đạo diễn đó bị vô hiệu hóa (disabled) để tránh gọi trùng.
- **BR-DR-02**: Khi thích/bỏ thích, UI cập nhật ngay lập tức (optimistic update) trước khi API trả về. Số lượt thích được tính dựa trên trạng thái trước đó và không được xuống dưới 0.
- **BR-DR-03**: Nếu API thích/bỏ thích trả lỗi, hệ thống rollback UI về trạng thái trước đó (cả số likeCount và trạng thái liked trong localStorage).
- **BR-DR-04**: Sau khi API thành công, số likeCount được sync với giá trị từ server để đảm bảo nhất quán dữ liệu.
- **BR-DR-05**: Trạng thái đã thích/chưa thích được lưu vào localStorage với key `director_liked_{directorId}` để persist qua các lần truy cập.
- **BR-DR-06**: Khi thay đổi quốc tịch hoặc cách sắp xếp, trang tự động reset về trang 1.
- **BR-DR-07**: Khi click vào đạo diễn, hệ thống điều hướng đến `/dao-dien-chi-tiet/:slug` với slug của đạo diễn.
- **BR-DR-08**: Danh sách quốc tịch được tải từ API `/api/v1/persons/nationalities?role=director` thay vì hardcode, đảm bảo dữ liệu luôn cập nhật theo database và chỉ lấy quốc tịch của đạo diễn (không lẫn diễn viên).
