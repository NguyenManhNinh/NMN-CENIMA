## 3.1.15. Phân tích yêu cầu phân hệ 12: Danh sách ưu đãi (PromotionListPage)

### 3.1.15.1. Mục tiêu và phạm vi phân hệ

Phân hệ PromotionListPage là trang hiển thị danh sách các chương trình ưu đãi và sự kiện đang hoạt động của rạp chiếu phim, đóng vai trò như một trung tâm thông tin khuyến mãi giúp người dùng khám phá và tận hưởng các ưu đãi hấp dẫn. Trang này cho phép người dùng xem danh sách ưu đãi theo nhiều tiêu chí sắp xếp, tương tác thông qua chức năng thích và điều hướng đến trang chi tiết để nhận voucher.

Phạm vi phân hệ bao gồm:
- Hiển thị danh sách ưu đãi theo dạng grid/card với thumbnail, tiêu đề, mô tả ngắn, lượt xem, lượt thích
- Hiển thị banner quảng cáo lớn (Bottom Banner) cho các ưu đãi nổi bật
- Sắp xếp danh sách theo: mới nhất, nổi bật, sắp kết thúc
- Phân trang với số trang điều hướng
- Tương tác thích/bỏ thích ưu đãi với optimistic update
- Điều hướng sang trang chi tiết ưu đãi
- Responsive layout cho desktop và mobile

### 3.1.15.2. Tác nhân và quyền hạn

| Tác nhân | Quyền hạn |
|:---------|:----------|
| Guest (khách) | Xem danh sách ưu đãi, sắp xếp, phân trang, xem chi tiết ưu đãi |
| User (thành viên) | Tất cả quyền của Guest + thích/bỏ thích ưu đãi, nhận voucher |

### 3.1.15.3. Yêu cầu chức năng (FR) – PromotionListPage

| ID | Yêu cầu | Mô tả | Ưu tiên |
|:---|:--------|:------|:--------|
| FR-PL-01 | Hiển thị danh sách ưu đãi | Render danh sách ưu đãi dạng card: thumbnail, tiêu đề, excerpt, lượt xem, lượt thích, thời gian còn lại | Cao |
| FR-PL-02 | Sắp xếp danh sách | Sắp xếp theo: mới nhất (newest), nổi bật (featured), sắp kết thúc (ending) | Cao |
| FR-PL-03 | Phân trang | Hiển thị 10 ưu đãi/trang với navigation số trang, cuộn lên đầu khi chuyển trang | Cao |
| FR-PL-04 | Thích ưu đãi | User có thể thích hoặc bỏ thích ưu đãi, cập nhật số lượt thích realtime | Cao |
| FR-PL-05 | Hiển thị lượt xem | Hiển thị số lượt xem (viewCount) của mỗi ưu đãi | Trung bình |
| FR-PL-06 | Điều hướng chi tiết | Click vào ưu đãi để xem trang chi tiết (/uu-dai/:slug) | Cao |
| FR-PL-07 | Bottom Banner Section | Hiển thị tối đa 2 banner lớn cho ưu đãi có displayPosition = BOTTOM_BANNER | Trung bình |
| FR-PL-08 | Loading State | Hiển thị loading spinner khi tải dữ liệu | Cao |
| FR-PL-09 | Hiển thị thời gian còn lại | Badge hiển thị số ngày còn lại trước khi ưu đãi kết thúc | Trung bình |
| FR-PL-10 | Lọc theo loại | Hỗ trợ lọc theo applyMode: ONLINE_VOUCHER, OFFLINE_ONLY, PAYMENT_METHOD_ONLY | Trung bình |
| FR-PL-11 | URL State Sync | Bộ lọc và trang hiện tại được lưu trong URL params để chia sẻ và bookmark | Trung bình |

### 3.1.15.4. Yêu cầu phi chức năng (NFR)

| ID | Yêu cầu | Mô tả |
|:---|:--------|:------|
| NFR-PL-01 | Hiệu năng | Trang load < 3 giây, API response < 500ms |
| NFR-PL-02 | Responsive | Hỗ trợ desktop và mobile, layout grid co giãn theo breakpoint |
| NFR-PL-03 | UX Optimistic | Cập nhật UI ngay khi thích/bỏ thích (optimistic update), rollback nếu API lỗi |
| NFR-PL-04 | Tương thích | Hoạt động tốt trên Chrome, Firefox, Safari, Edge phiên bản mới nhất |
| NFR-PL-05 | Khả dụng | Có fallback khi API lỗi (hiển thị danh sách rỗng), không crash ứng dụng |
| NFR-PL-06 | Lazy Loading | Ảnh thumbnail sử dụng lazy loading để tối ưu hiệu năng |

### 3.1.15.5. Quy tắc nghiệp vụ

- **BR-PL-01 (Chỉ hiển thị ưu đãi active):** Danh sách chỉ hiển thị các ưu đãi có status = 'ACTIVE', publishAt <= now, startAt <= now và endAt >= now.

- **BR-PL-02 (Phân biệt displayPosition):** Ưu đãi có displayPosition = 'LIST' hiển thị trong grid chính, displayPosition = 'BOTTOM_BANNER' hiển thị ở section banner phía dưới.

- **BR-PL-03 (Optimistic Update Like):** Khi thích/bỏ thích, UI cập nhật ngay lập tức trước khi API trả về. Số lượt thích được tính dựa trên trạng thái trước đó và không được xuống dưới 0.

- **BR-PL-04 (Rollback khi API lỗi):** Nếu API toggle like trả lỗi, hệ thống rollback UI về trạng thái trước đó.

- **BR-PL-05 (Banner sort order):** Bottom Banner được sắp xếp theo bannerOrder (ascending), tối đa 2 banner.

- **BR-PL-06 (Fallback ảnh):** Khi ảnh thumbnail lỗi, hiển thị ảnh fallback SVG placeholder thay vì để trống.

- **BR-PL-07 (Thời gian còn lại):** Hiển thị số ngày còn lại = endAt - now. Nếu còn < 3 ngày, highlight badge màu đỏ để thu hút chú ý.

---

*Phần phân tích yêu cầu trên đây là cơ sở để thiết kế kiến trúc hệ thống, sơ đồ Use Case, Activity Diagram, Sequence Diagram và Class Diagram trong mục 3.2 tiếp theo.*
