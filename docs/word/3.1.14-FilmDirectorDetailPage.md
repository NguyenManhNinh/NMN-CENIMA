# 3.1.14. Phân tích yêu cầu phân hệ 11: Chi tiết đạo diễn (FilmDirectorDetailPage)

## 3.1.14.1. Mục tiêu và phạm vi phân hệ

Phân hệ FilmDirectorDetailPage là trang hiển thị thông tin chi tiết của một đạo diễn, bao gồm thông tin cá nhân, tiểu sử đầy đủ, thư viện hình ảnh và danh sách phim đã đạo diễn. Trang này cho phép người dùng khám phá sâu hơn về đạo diễn yêu thích, xem gallery ảnh với chế độ slideshow tự động và tương tác thông qua chức năng thích.

Phạm vi phân hệ bao gồm:
- Hiển thị thông tin cá nhân đạo diễn (tên, ảnh đại diện, ngày sinh, chiều cao, quốc tịch, nơi sinh, nghề nghiệp).
- Hiển thị tiểu sử ngắn và tiểu sử đầy đủ.
- Thư viện hình ảnh với chế độ xem phóng to và tự động chuyển ảnh.
- Danh sách phim đã đạo diễn (Filmography) với điều hướng đến chi tiết phim.
- Tăng lượt xem với cơ chế cooldown 24 giờ.
- Thích/bỏ thích đạo diễn với optimistic update và rollback.
- Sidebar hiển thị phim đang chiếu.
- Breadcrumb điều hướng.
- Fallback "Đang cập nhật" khi thiếu dữ liệu.

## 3.1.14.2. Tác nhân và quyền hạn

| Tác nhân | Quyền hạn |
|:---------|:----------|
| Guest (khách) | Xem thông tin đạo diễn, xem gallery ảnh, xem filmography, xem tiểu sử, xem sidebar phim đang chiếu |
| User (thành viên) | Tất cả quyền của Guest + thích/bỏ thích đạo diễn |

## 3.1.14.3. Yêu cầu chức năng (FR)

| ID | Yêu cầu | Mô tả | Ưu tiên |
|:---|:--------|:------|:--------|
| FR-DD-01 | Hiển thị thông tin cá nhân | Hiển thị ảnh đại diện, tên, ngày sinh, chiều cao, quốc tịch, nơi sinh, nghề nghiệp | Cao |
| FR-DD-02 | Hiển thị tiểu sử ngắn | Hiển thị shortBio dạng italic, line clamp 4 dòng trên mobile | Cao |
| FR-DD-03 | Hiển thị tiểu sử đầy đủ | Section Tiểu sử với nội dung fullBio/biography đầy đủ | Cao |
| FR-DD-04 | Thư viện hình ảnh | Grid ảnh với preview, click mở Dialog xem phóng to | Cao |
| FR-DD-05 | Gallery Lightbox | Dialog xem ảnh full screen với nút prev/next, đóng bằng nút X | Cao |
| FR-DD-06 | Gallery Autoplay | Tự động chuyển ảnh mỗi 3 giây, có nút Play/Pause để điều khiển | Trung bình |
| FR-DD-07 | Hiển thị Filmography | Section "PHIM ĐÃ ĐẠO DIỄN" với danh sách phim: poster, tên phim, vai trò | Cao |
| FR-DD-08 | Điều hướng đến phim | Click vào phim trong filmography chuyển đến `/phim/:slug` | Cao |
| FR-DD-09 | Thích đạo diễn | Nút like với số lượt thích, cập nhật realtime | Cao |
| FR-DD-10 | Hiển thị lượt xem | Badge hiển thị viewCount của đạo diễn | Trung bình |
| FR-DD-11 | Tăng lượt xem | Tự động tăng viewCount khi truy cập, có cooldown 24 giờ | Cao |
| FR-DD-12 | Breadcrumb | Hiển thị đường dẫn: Trang chủ > Đạo diễn > [Tên đạo diễn] | Cao |
| FR-DD-13 | Sidebar phim đang chiếu | Hiển thị phim đang chiếu ở sidebar với poster, tên, rating | Trung bình |
| FR-DD-14 | Loading State | Hiển thị loading spinner toàn màn hình khi tải dữ liệu | Cao |
| FR-DD-15 | Xử lý 404 | Hiển thị thông báo "Không tìm thấy đạo diễn" với nút quay lại danh sách | Cao |

## 3.1.14.4. Yêu cầu phi chức năng (NFR)

| ID | Yêu cầu | Mô tả |
|:---|:--------|:------|
| NFR-DD-01 | Hiệu năng | Trang load < 3 giây, API response < 500ms, gọi song song bằng Promise.all |
| NFR-DD-02 | Responsive | Layout thích ứng desktop/mobile/tablet, ảnh scroll ngang trên mobile |
| NFR-DD-03 | UX Optimistic | Cập nhật UI ngay khi thích/bỏ thích và tăng view, rollback nếu API lỗi |
| NFR-DD-04 | Khả dụng | Có fallback "Đang cập nhật" khi thiếu dữ liệu, không crash ứng dụng |
| NFR-DD-05 | Tương thích | Hoạt động tốt trên Chrome, Firefox, Safari, Edge phiên bản mới nhất |
| NFR-DD-06 | Accessibility | Gallery hỗ trợ điều hướng bằng nút, Breadcrumb có semantic rõ ràng |

## 3.1.14.5. Quy tắc nghiệp vụ

- **BR-DD-01**: Lượt xem của một đạo diễn chỉ được tăng 1 lần mỗi 24 giờ cho mỗi trình duyệt. Thời gian truy cập cuối được lưu trong localStorage với key `director_view_{directorId}`. Nếu thời gian hiện tại trừ thời gian lưu nhỏ hơn 24 giờ (86,400,000ms), hệ thống không gọi API tăng view.
- **BR-DD-02**: Sử dụng useRef để đánh dấu đã tăng view trong session hiện tại (`viewIncrementedRef`), tránh gọi API trùng lặp khi component re-render hoặc trong React StrictMode.
- **BR-DD-03**: Khi thích/bỏ thích, UI cập nhật ngay lập tức (isLiked, likeCount, localStorage) trước khi API trả về. Số likeCount không được xuống dưới 0.
- **BR-DD-04**: Nếu API toggle like trả về lỗi, hệ thống rollback về trạng thái trước đó bao gồm: isLiked state, likeCount trong director state và giá trị trong localStorage.
- **BR-DD-05**: Sau khi API thành công, likeCount được sync với giá trị từ server (`res.data.likeCount`) để đảm bảo nhất quán.
- **BR-DD-06**: Khi các trường thông tin không có giá trị (biography, filmography, photos), hệ thống hiển thị text "Đang cập nhật" thay vì để trống hoặc gây lỗi giao diện.
- **BR-DD-07**: Gallery chỉ hiển thị khi `director.photos` tồn tại và có độ dài > 0. Autoplay chỉ hoạt động khi có nhiều hơn một ảnh.
- **BR-DD-08**: Hệ thống tải đạo diễn theo slug từ URL params. Nếu không tìm thấy (directorData = null hoặc role không phải 'director'/'both'), hiển thị màn hình 404 với nút quay lại.
