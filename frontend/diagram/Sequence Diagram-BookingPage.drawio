<mxfile host="app.diagrams.net">
  <diagram name="Sequence Diagram - ÄÃ¡nh giÃ¡ phim" id="sequence-rating">
    <mxGraphModel dx="1600" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1600" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="Sequence Diagram - ÄÃ¡nh giÃ¡ phim (Rating Movie)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="700" height="40" as="geometry" />
        </mxCell>

        <!-- Actor: User -->
        <mxCell id="actor-user" value="" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="60" y="90" width="40" height="80" as="geometry" />
        </mxCell>

        <mxCell id="actor-user-label" value="&lt;b&gt;User&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="40" y="180" width="80" height="30" as="geometry" />
        </mxCell>

        <!-- Lifeline: User -->
        <mxCell id="lifeline-user" value="" style="endArrow=none;dashed=1;html=1;strokeWidth=2;strokeColor=#666666" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="79.5" y="210" as="sourcePoint" />
            <mxPoint x="79.5" y="1520" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Participant: BookingPage -->
        <mxCell id="participant-booking" value="&lt;b&gt;:BookingPage&lt;/b&gt;&lt;br/&gt;(React)" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="240" y="90" width="140" height="1430" as="geometry" />
        </mxCell>

        <!-- Participant: movieApi -->
        <mxCell id="participant-api" value="&lt;b&gt;:movieApi&lt;/b&gt;&lt;br/&gt;(Axios)" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#e1d5e7;strokeColor=#9673a6;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="520" y="90" width="140" height="1430" as="geometry" />
        </mxCell>

        <!-- Participant: Backend -->
        <mxCell id="participant-backend" value="&lt;b&gt;:Backend&lt;/b&gt;&lt;br/&gt;(Express)" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="800" y="90" width="140" height="1430" as="geometry" />
        </mxCell>

        <!-- Participant: MongoDB -->
        <mxCell id="participant-db" value="&lt;b&gt;:MongoDB&lt;/b&gt;&lt;br/&gt;(Database)" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#f8cecc;strokeColor=#b85450;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="1080" y="90" width="140" height="1430" as="geometry" />
        </mxCell>

        <!-- Activation Boxes -->
        <mxCell id="act-user-1" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="75" y="250" width="10" height="40" as="geometry" />
        </mxCell>

        <mxCell id="act-user-2" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="75" y="370" width="10" height="40" as="geometry" />
        </mxCell>

        <mxCell id="act-user-3" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="75" y="460" width="10" height="40" as="geometry" />
        </mxCell>

        <mxCell id="act-booking-main" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="305" y="250" width="10" height="1220" as="geometry" />
        </mxCell>

        <mxCell id="act-booking-self1" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;fillColor=#ffe6cc;strokeColor=#d79b00;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="315" y="290" width="10" height="40" as="geometry" />
        </mxCell>

        <mxCell id="act-api-main" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;fillColor=#e1d5e7;strokeColor=#9673a6;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="585" y="540" width="10" height="880" as="geometry" />
        </mxCell>

        <mxCell id="act-backend-main" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="865" y="590" width="10" height="810" as="geometry" />
        </mxCell>

        <mxCell id="act-db-1" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;fillColor=#f8cecc;strokeColor=#b85450;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="1145" y="1150" width="10" height="60" as="geometry" />
        </mxCell>

        <mxCell id="act-db-2" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;fillColor=#f8cecc;strokeColor=#b85450;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="1145" y="1250" width="10" height="60" as="geometry" />
        </mxCell>

        <mxCell id="act-booking-self2" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;fillColor=#ffe6cc;strokeColor=#d79b00;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="315" y="1360" width="10" height="40" as="geometry" />
        </mxCell>

        <!-- Message 1: User -> BookingPage -->
        <mxCell id="msg1" value="" style="endArrow=block;endFill=1;html=1;strokeWidth=2;strokeColor=#000000" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="85" y="270" as="sourcePoint" />
            <mxPoint x="305" y="270" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg1-label" value="&lt;b&gt;1: Click &quot;ÄÃ¡nh giÃ¡ phim&quot;&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=bottom;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="110" y="245" width="160" height="20" as="geometry" />
        </mxCell>

        <!-- Message 2: Self-call openRatingModal -->
        <mxCell id="msg2" value="" style="endArrow=block;endFill=1;html=1;strokeWidth=2;strokeColor=#000000;edgeStyle=orthogonalEdgeStyle" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="315" y="290" as="sourcePoint" />
            <mxPoint x="315" y="330" as="targetPoint" />
            <Array as="points">
              <mxPoint x="360" y="290" />
              <mxPoint x="360" y="330" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="msg2-label" value="&lt;b&gt;2: openRatingModal()&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="370" y="300" width="140" height="20" as="geometry" />
        </mxCell>

        <!-- Message 3: User -> BookingPage -->
        <mxCell id="msg3" value="" style="endArrow=block;endFill=1;html=1;strokeWidth=2;strokeColor=#000000" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="85" y="390" as="sourcePoint" />
            <mxPoint x="305" y="390" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg3-label" value="&lt;b&gt;3: Chá»n sao + nháº­p comment&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=bottom;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="100" y="365" width="190" height="20" as="geometry" />
        </mxCell>

        <!-- Message 4: User -> BookingPage Submit -->
        <mxCell id="msg4" value="" style="endArrow=block;endFill=1;html=1;strokeWidth=2;strokeColor=#000000" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="85" y="480" as="sourcePoint" />
            <mxPoint x="305" y="480" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg4-label" value="&lt;b&gt;4: Submit Ä‘Ã¡nh giÃ¡&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=bottom;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="130" y="455" width="120" height="20" as="geometry" />
        </mxCell>

        <!-- Message 5: BookingPage -> movieApi -->
        <mxCell id="msg5" value="" style="endArrow=block;endFill=1;html=1;strokeWidth=2;strokeColor=#000000" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="315" y="560" as="sourcePoint" />
            <mxPoint x="585" y="560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg5-label" value="&lt;b&gt;5: rateMovie(movieId, {stars, comment})&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=bottom;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="330" y="535" width="240" height="20" as="geometry" />
        </mxCell>

        <!-- Message 6: movieApi -> Backend -->
        <mxCell id="msg6" value="" style="endArrow=block;endFill=1;html=1;strokeWidth=2;strokeColor=#000000" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="595" y="610" as="sourcePoint" />
            <mxPoint x="865" y="610" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg6-label" value="&lt;b&gt;6: POST /api/v1/movies/:id/rate&lt;/b&gt;&lt;br/&gt;&lt;font style=&quot;font-size:9px&quot;&gt;Authorization: Bearer JWT&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=bottom;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="625" y="575" width="210" height="30" as="geometry" />
        </mxCell>

        <!-- ALT Frame -->
        <mxCell id="alt-frame" value="" style="shape=umlFrame;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#666666;strokeWidth=2;width=60;height=30" vertex="1" parent="1">
          <mxGeometry x="840" y="650" width="410" height="720" as="geometry" />
        </mxCell>

        <mxCell id="alt-label" value="alt" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="845" y="653" width="50" height="25" as="geometry" />
        </mxCell>

        <!-- Alt Option 1: 401 Unauthorized -->
        <mxCell id="alt-condition1" value="[401 Unauthorized: JWT missing/expired]" style="text;html=1;strokeColor=none;fillColor=#ffe6cc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=2" vertex="1" parent="1">
          <mxGeometry x="900" y="690" width="280" height="20" as="geometry" />
        </mxCell>

        <mxCell id="msg7a" value="" style="endArrow=open;endFill=0;dashed=1;html=1;strokeWidth=2;strokeColor=#b85450" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="865" y="730" as="sourcePoint" />
            <mxPoint x="595" y="730" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg7a-label" value="&lt;b&gt;7a: 401 Unauthorized&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=bottom;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#b85450;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="660" y="705" width="140" height="20" as="geometry" />
        </mxCell>

        <mxCell id="msg8a" value="" style="endArrow=open;endFill=0;dashed=1;html=1;strokeWidth=2;strokeColor=#b85450" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="585" y="760" as="sourcePoint" />
            <mxPoint x="315" y="760" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg8a-label" value="&lt;b&gt;8a: error 401&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=bottom;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#b85450;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="735" width="100" height="20" as="geometry" />
        </mxCell>

        <mxCell id="msg9a" value="" style="endArrow=open;endFill=0;dashed=1;html=1;strokeWidth=2;strokeColor=#b85450" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="305" y="790" as="sourcePoint" />
            <mxPoint x="85" y="790" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg9a-label" value="&lt;b&gt;9a: &quot;Vui lÃ²ng Ä‘Äƒng nháº­p&quot;&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=bottom;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#b85450;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="110" y="765" width="180" height="20" as="geometry" />
        </mxCell>

        <!-- Divider line 1 -->
        <mxCell id="divider1" value="" style="endArrow=none;dashed=1;html=1;strokeWidth=1;strokeColor=#666666" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="840" y="840" as="sourcePoint" />
            <mxPoint x="1250" y="840" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Alt Option 2: 400 Bad Request -->
        <mxCell id="alt-condition2" value="[400 Bad Request: validation fail]" style="text;html=1;strokeColor=none;fillColor=#ffe6cc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=2" vertex="1" parent="1">
          <mxGeometry x="900" y="855" width="250" height="20" as="geometry" />
        </mxCell>

        <mxCell id="msg7b" value="" style="endArrow=open;endFill=0;dashed=1;html=1;strokeWidth=2;strokeColor=#b85450" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="865" y="895" as="sourcePoint" />
            <mxPoint x="595" y="895" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg7b-label" value="&lt;b&gt;7b: 400 Bad Request&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=bottom;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#b85450;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="660" y="870" width="140" height="20" as="geometry" />
        </mxCell>

        <mxCell id="msg8b" value="" style="endArrow=open;endFill=0;dashed=1;html=1;strokeWidth=2;strokeColor=#b85450" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="585" y="925" as="sourcePoint" />
            <mxPoint x="315" y="925" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg8b-label" value="&lt;b&gt;8b: error 400&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=bottom;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#b85450;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="900" width="100" height="20" as="geometry" />
        </mxCell>

        <mxCell id="msg9b" value="" style="endArrow=open;endFill=0;dashed=1;html=1;strokeWidth=2;strokeColor=#b85450" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="305" y="955" as="sourcePoint" />
            <mxPoint x="85" y="955" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg9b-label" value="&lt;b&gt;9b: &quot;Lá»—i validation&quot;&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=bottom;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#b85450;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="130" y="930" width="140" height="20" as="geometry" />
        </mxCell>

        <!-- Divider line 2 -->
        <mxCell id="divider2" value="" style="endArrow=none;dashed=1;html=1;strokeWidth=1;strokeColor=#666666" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="840" y="1005" as="sourcePoint" />
            <mxPoint x="1250" y="1005" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Alt Option 3: 200 OK Success -->
        <mxCell id="alt-condition3" value="[200 OK: success]" style="text;html=1;strokeColor=none;fillColor=#d5e8d4;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=2" vertex="1" parent="1">
          <mxGeometry x="900" y="1020" width="130" height="20" as="geometry" />
        </mxCell>

        <!-- Message 7c: Backend -> MongoDB (insert Review) -->
        <mxCell id="msg7c" value="" style="endArrow=block;endFill=1;html=1;strokeWidth=2;strokeColor=#000000" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="875" y="1170" as="sourcePoint" />
            <mxPoint x="1145" y="1170" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg7c-label" value="&lt;b&gt;7c: insert Review&lt;/b&gt;&lt;br/&gt;&lt;font style=&quot;font-size:9px&quot;&gt;(movieId, userId, stars, comment)&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=bottom;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="920" y="1140" width="180" height="30" as="geometry" />
        </mxCell>

        <!-- Message 8c: MongoDB -> Backend (return reviewId) -->
        <mxCell id="msg8c" value="" style="endArrow=open;endFill=0;dashed=1;html=1;strokeWidth=2;strokeColor=#82b366" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1145" y="1210" as="sourcePoint" />
            <mxPoint x="875" y="1210" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg8c-label" value="&lt;b&gt;8c: reviewId&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=bottom;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#82b366;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="960" y="1185" width="100" height="20" as="geometry" />
        </mxCell>

        <!-- Message 9c: Backend -> MongoDB (update Movie) -->
        <mxCell id="msg9c" value="" style="endArrow=block;endFill=1;html=1;strokeWidth=2;strokeColor=#000000" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="875" y="1270" as="sourcePoint" />
            <mxPoint x="1145" y="1270" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg9c-label" value="&lt;b&gt;9c: update Movie&lt;/b&gt;&lt;br/&gt;&lt;font style=&quot;font-size:9px&quot;&gt;(rating, ratingCount)&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=bottom;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="930" y="1240" width="160" height="30" as="geometry" />
        </mxCell>

        <!-- Message 10c: MongoDB -> Backend (ok) -->
        <mxCell id="msg10c" value="" style="endArrow=open;endFill=0;dashed=1;html=1;strokeWidth=2;strokeColor=#82b366" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1145" y="1310" as="sourcePoint" />
            <mxPoint x="875" y="1310" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg10c-label" value="&lt;b&gt;10c: ok&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=bottom;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#82b366;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="980" y="1285" width="60" height="20" as="geometry" />
        </mxCell>

        <!-- Message 11c: Backend -> movieApi (return success) -->
        <mxCell id="msg11c" value="" style="endArrow=open;endFill=0;dashed=1;html=1;strokeWidth=2;strokeColor=#82b366" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="865" y="1350" as="sourcePoint" />
            <mxPoint x="595" y="1350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg11c-label" value="&lt;b&gt;11c: 200 {rating: 8.5, ratingCount: 1234}&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=bottom;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#82b366;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="625" y="1325" width="210" height="20" as="geometry" />
        </mxCell>

        <!-- Message 12: movieApi -> BookingPage (return) -->
        <mxCell id="msg12" value="" style="endArrow=open;endFill=0;dashed=1;html=1;strokeWidth=2;strokeColor=#82b366" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="585" y="1390" as="sourcePoint" />
            <mxPoint x="315" y="1390" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg12-label" value="&lt;b&gt;12: response data&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=bottom;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#82b366;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="390" y="1365" width="120" height="20" as="geometry" />
        </mxCell>

        <!-- Message 13: Self-call updateState -->
        <mxCell id="msg13" value="" style="endArrow=block;endFill=1;html=1;strokeWidth=2;strokeColor=#000000;edgeStyle=orthogonalEdgeStyle" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="315" y="1360" as="sourcePoint" />
            <mxPoint x="315" y="1400" as="targetPoint" />
            <Array as="points">
              <mxPoint x="360" y="1360" />
              <mxPoint x="360" y="1400" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="msg13-label" value="&lt;b&gt;13: updateMovieState()&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="370" y="1370" width="150" height="20" as="geometry" />
        </mxCell>

        <!-- Message 14: BookingPage -> User (Toast) -->
        <mxCell id="msg14" value="" style="endArrow=open;endFill=0;dashed=1;html=1;strokeWidth=2;strokeColor=#82b366" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="305" y="1440" as="sourcePoint" />
            <mxPoint x="85" y="1440" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg14-label" value="&lt;b&gt;14: Toast &quot;ÄÃ¡nh giÃ¡ thÃ nh cÃ´ng&quot;&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=bottom;whiteSpace=wrap;rounded=0;fontSize=11;fontColor=#82b366;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="110" y="1415" width="180" height="20" as="geometry" />
        </mxCell>

        <!-- Notes -->
        <mxCell id="note1" value="&lt;b&gt;ChÃº thÃ­ch UML:&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;â€¢ &lt;b&gt;Solid arrow (â†’):&lt;/b&gt; Synchronous call&lt;br/&gt;â€¢ &lt;b&gt;Dashed arrow (â¤):&lt;/b&gt; Return message&lt;br/&gt;â€¢ &lt;b&gt;Alt frame:&lt;/b&gt; Conditional flow&lt;br/&gt;â€¢ &lt;b&gt;Guard [condition]:&lt;/b&gt; Branch condition&lt;br/&gt;â€¢ &lt;b&gt;Activation box:&lt;/b&gt; Object lifetime&lt;br/&gt;&lt;br/&gt;&lt;b&gt;MÃ u sáº¯c:&lt;/b&gt;&lt;br/&gt;â€¢ ðŸ”´ MÃ u Ä‘á»: Error flows&lt;br/&gt;â€¢ ðŸŸ¢ MÃ u xanh: Success flow&lt;br/&gt;â€¢ âš« MÃ u Ä‘en: Request calls&lt;br/&gt;&lt;br/&gt;&lt;b&gt;Message numbering:&lt;/b&gt;&lt;br/&gt;â€¢ 7a, 8a, 9a: 401 flow&lt;br/&gt;â€¢ 7b, 8b, 9b: 400 flow&lt;br/&gt;â€¢ 7c-14: Success flow" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpaque=0;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;fontSize=9;spacingLeft=10;spacingTop=10;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="40" y="550" width="180" height="310" as="geometry" />
        </mxCell>

        <mxCell id="note2" value="&lt;b&gt;API Details:&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;&lt;b&gt;Endpoint:&lt;/b&gt;&lt;br/&gt;POST /api/v1/movies/:id/rate&lt;br/&gt;&lt;br/&gt;&lt;b&gt;Headers:&lt;/b&gt;&lt;br/&gt;Authorization: Bearer {JWT}&lt;br/&gt;&lt;br/&gt;&lt;b&gt;Request Body:&lt;/b&gt;&lt;br/&gt;{&lt;br/&gt;  &quot;stars&quot;: 8,&lt;br/&gt;  &quot;comment&quot;: &quot;Phim hay!&quot;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;b&gt;Response 200:&lt;/b&gt;&lt;br/&gt;{&lt;br/&gt;  &quot;rating&quot;: 8.5,&lt;br/&gt;  &quot;ratingCount&quot;: 1234&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;b&gt;Response 401:&lt;/b&gt;&lt;br/&gt;{&lt;br/&gt;  &quot;error&quot;: &quot;Unauthorized&quot;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;b&gt;Response 400:&lt;/b&gt;&lt;br/&gt;{&lt;br/&gt;  &quot;error&quot;: &quot;Validation failed&quot;&lt;br/&gt;}" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpaque=0;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;verticalAlign=top;fontSize=9;spacingLeft=10;spacingTop=10;strokeWidth=2;fontFamily=Courier New;" vertex="1" parent="1">
          <mxGeometry x="40" y="900" width="180" height="400" as="geometry" />
        </mxCell>

        <mxCell id="note3" value="&lt;b&gt;Database Operations:&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;&lt;b&gt;1. Insert Review:&lt;/b&gt;&lt;br/&gt;db.reviews.insertOne({&lt;br/&gt;  movieId,&lt;br/&gt;  userId,&lt;br/&gt;  stars: 8,&lt;br/&gt;  comment: &quot;...&quot;,&lt;br/&gt;  createdAt: now&lt;br/&gt;})&lt;br/&gt;&lt;br/&gt;&lt;b&gt;2. Update Movie:&lt;/b&gt;&lt;br/&gt;db.movies.updateOne(&lt;br/&gt;  {_id: movieId},&lt;br/&gt;  {$set: {&lt;br/&gt;    rating: newAvg,&lt;br/&gt;    ratingCount: count + 1&lt;br/&gt;  }}&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;b&gt;Logic tÃ­nh rating:&lt;/b&gt;&lt;br/&gt;newRating = &lt;br/&gt;  (oldRating * count + stars)&lt;br/&gt;  / (count + 1)" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpaque=0;fillColor=#f8cecc;strokeColor=#b85450;align=left;verticalAlign=top;fontSize=8;spacingLeft=10;spacingTop=10;strokeWidth=2;fontFamily=Courier New;" vertex="1" parent="1">
          <mxGeometry x="1270" y="90" width="210" height="380" as="geometry" />
        </mxCell>

        <mxCell id="note4" value="&lt;b&gt;Luá»“ng thá»±c thi:&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;&lt;b&gt;Main flow (Success):&lt;/b&gt;&lt;br/&gt;1-6: User input â†’ API call&lt;br/&gt;7c: Insert review to DB&lt;br/&gt;8c: Get reviewId&lt;br/&gt;9c: Update movie rating&lt;br/&gt;10c: DB confirm&lt;br/&gt;11c-14: Return to User&lt;br/&gt;&lt;br/&gt;&lt;b&gt;Error flows:&lt;/b&gt;&lt;br/&gt;â€¢ 401: No/expired JWT&lt;br/&gt;  â†’ Redirect to login&lt;br/&gt;â€¢ 400: Invalid input&lt;br/&gt;  â†’ Show validation msg&lt;br/&gt;&lt;br/&gt;&lt;b&gt;Validation rules:&lt;/b&gt;&lt;br/&gt;â€¢ stars: 1-10&lt;br/&gt;â€¢ comment: 0-500 chars&lt;br/&gt;â€¢ movieId: valid ObjectId&lt;br/&gt;â€¢ userId: from JWT" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpaque=0;fillColor=#d5e8d4;strokeColor=#82b366;align=left;verticalAlign=top;fontSize=9;spacingLeft=10;spacingTop=10;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="1270" y="500" width="210" height="360" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>